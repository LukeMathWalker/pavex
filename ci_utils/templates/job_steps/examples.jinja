<% extends 'steps' %>
<% block inner_steps %>
- name: Install Rust
  uses: actions-rust-lang/setup-rust-toolchain@v1.8.0
  with:
    cache-workspaces: "./examples/starter -> ./target"
- name: Install cargo-binstall
  uses: cargo-bins/cargo-binstall@main
- name: Install cargo-px
  run: cargo binstall -y --force --github-token=${{ secrets.GITHUB_TOKEN }} cargo-px --version="^0.1.15"
<% include 'setup_pavex' %>
- name: Check that starter compiles
  env:
    PAVEX_DEBUG: "true"
    PAVEX_PAVEXC: << pavexc_path(target) >>
  run: |
    cd examples/starter
    cargo px test
- name: Check starter is up to date
  run: |
    cd examples
    rm -rf starter
    pavex new starter
    # Remove the git folder
    rm -rf starter/.git
    # Check if any of the files changed
    git diff --exit-code starter || (echo "Starter project is not up to date. Regenerate it using 'pavex new'" && exit 1)
<%- endblock %>
