# This whole file is generated by a Rust script under `ci_utils`
# Do NOT edit this file manually.
name: Build and store docs artifact

on:
  workflow_dispatch:
  # See https://github.com/imjohnbo/ok-to-test/tree/master for an overview
  # of how this works.
  # I officially hate GitHub for forbidding OpenID Connect tokens in forks.
  repository_dispatch:
    types: [ok-to-test-command]
  push:
    branches:
      - main

jobs:
  <%- for (os, target, binary_extension) in [
    ('ubuntu-latest', 'linux', ''), 
    ('macos-14', 'macos', ''), 
    ('windows-2022', 'windows', '.exe')
  ] %>
  
  build_clis_<<- target >>:
    name: "Build CLIs (<<- target >>)"
    runs-on: << os >>
    <%- with job_name = "Build CLIs (<<- target >>)" -%>
      <%- from 'build_clis_steps' import output -%>  
      <<- output | indent(4) >>
    <%- endwith %>
    
  tests_<<- target >>:
    name: "Run tests (<<- target >>)"
    runs-on: << os >>
    needs:
      - build_clis_<<- target >>
    <%- with job_name = 'Run tests (<< target >>)' -%>
      <%- from 'tests_steps' import output -%>  
      <<- output | indent(4) >>
    <%- endwith %>
  <%- endfor %>

  build_tutorial_generator:
    runs-on: ubuntu-latest
    <%- with job_name = 'Build tutorial generator' -%>
      <%- from 'build_tutorial_generator_steps' import output -%>  
      <<- output | indent(4) ->>
    <%- endwith %>

  is_up_to_date:
    runs-on: ubuntu-latest
    env:
      PAVEX_PAVEXC: "/home/runner/.cargo/bin/pavexc"
    needs:
      - build_clis_linux
      - build_tutorial_generator
    <%- with job_name = 'Check if up to date' -%>
      <%- from 'is_up_to_date_steps' import output -%>  
      <<- output | indent(4) >>
    <%- endwith %>

  build_docs:
    runs-on: ubuntu-latest
    <%- with job_name = 'Build docs' %>
      <%- from 'build_docs_steps' import output %>  
      <<- output | indent(4) >>
    <%- endwith %>
