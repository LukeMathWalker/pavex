# New configuration entries

Use the [`#[config]`][config_attr] attribute to define a new configuration entry:

--8<-- "docs/examples/configuration/derives.snap"

1. Deriving the required traits.

The [`#[config]`][config_attr] attribute expects a [unique configuration key](#configuration-key) as argument.

## Required traits

The annotated type must implement the [`Debug`][Debug], [`Clone`][Clone], and [`serde::Deserialize`][Deserialize] traits.

As you have seen in the example above, the required trait implementations can be derived automatically. If necessary, check out [`serde`'s documentation](https://serde.rs/) for more information on how to customize the deserialization process.

## Registration

Use an import to register in bulk all the configuration entries defined in the current crate:

--8<-- "docs/examples/configuration/import.snap"

1. You can also import configuration entries from [other crates][import_other_crates] or [specific modules][import_specific_modules].

Alternatively, register configuration entries one by one using [`Blueprint::config`][Blueprint::config]:

--8<-- "docs/examples/configuration/register_one.snap"

1. `DATABASE_CONFIG` is a strongly-typed constant generated by the [`#[config]`][config_attr] attribute on the `DatabaseConfig` type.\
   Check out the documentation on [component ids](/guide/attributes/component_id.md) for more details.

## Configuration key

The configuration key uniquely identifies a configuration entry within a Pavex application. It must start with a letter and can contain letters, digits and underscores.

Every configuration entry becomes a field in [`ApplicationConfig`](application_config.md), and the configuration key is used as the field name.
The key determines the expected configuration schemaâ€”e.g. [which environment variables can be used to
set its value](loading.md#environment-variables) and the structure of configuration files.

## Lifecycle

Configuration entries are treated as [singletons][Lifecycle::Singleton] from Pavex's [dependency injection system][DI].

Most configuration entries are only needed to construct other [singletons][Lifecycle::Singleton],
so they'll be discarded after [`ApplicationState::new`][ApplicationState] returns.

If a configuration entry is needed at runtime (e.g. to configure the behaviour of middleware or a request handler),
it'll be added as a field to [`ApplicationState`][ApplicationState].
In this case, Pavex will expect the configuration type to implement the [`Send`][Send] and [`Sync`][Sync] traits in addition
to the other [trait requirements](#required-traits).

[Lifecycle::Singleton]: /api_reference/pavex/blueprint/constructor/enum.Lifecycle.html#variant.Singleton
[ApplicationState]: /guide/dependency_injection/application_state.md
[Send]: https://doc.rust-lang.org/std/marker/trait.Send.html
[Sync]: https://doc.rust-lang.org/std/marker/trait.Sync.html
[Blueprint::config]: /api_reference/pavex/blueprint/struct.Blueprint.html#method.config
[Blueprint]: /api_reference/pavex/blueprint/struct.Blueprint.html
[server_crate]: /guide/project_structure/server.md
[Debug]: https://doc.rust-lang.org/std/fmt/trait.Debug.html
[Clone]: https://doc.rust-lang.org/std/clone/trait.Clone.html
[Deserialize]: https://docs.rs/serde/latest/serde/trait.Deserialize.html
[DI]: /guide/dependency_injection/index.md
[config_attr]: /api_reference/pavex/attr.config.html
[import_other_crates]: /api_reference/pavex/struct.Blueprint.html#dependencies
[import_specific_modules]: /api_reference/pavex/struct.Blueprint.html#specific-modules
