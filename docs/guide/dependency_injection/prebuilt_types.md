# Prebuilt types

A **prebuilt type** is a type that Pavex expects **you** to build.\
Whenever your mark a type as prebuilt, you're telling Pavex: "I'll build
this type on my own, and then pass an instance over to you".
In particular, you'll be passing that instance to [`ApplicationState::new`](application_state.md), the constructor that Pavex generates for [`ApplicationState`](application_state.md).

## Defining a constructor

Use the [`#[prebuilt]`][prebuilt_attr] attribute to define a new prebuilt type:

--8<-- "docs/examples/dependency_injection/prebuilt/pool.snap"

## Registration

Use an import to register in bulk all the prebuilt types defined in the current crate:

--8<-- "docs/examples/dependency_injection/prebuilt/registration.snap"

1. You can also import prebuilt types from [other crates][import_other_crates] or [specific modules][import_specific_modules].

Alternatively, register prebuilt types one by one using [`Blueprint::prebuilt`][Blueprint::prebuilt]:

--8<-- "docs/examples/dependency_injection/prebuilt/register_one.snap"

1. `DB_CONNECTION_POOL` is a strongly-typed constant generated by the [`#[prebuilt]`][prebuilt_attr] attribute on the `DbConnectionPool` type.\
   Check out the documentation on [component ids](/guide/attributes/component_id.md) for more details.

## The signature changes

Whenever you mark a type as prebuilt, the signature of the code-generated
[`ApplicationState::new`](application_state.md) method will change to include that type as an input parameter.\
In the generated server SDK for the example in the previous section, the signature of `ApplicationState::new` will change to:

--8<-- "docs/examples/dependency_injection/prebuilt/build_state.snap"

Since the signature of `ApplicationState::new` changes, the calling code in [your server crate][server_crate] will have to change accordingly.
This may be surprising at first, since you don't often touch the code inside [the server crate][server_crate], but it's entirely expected. Don't worry: you just have to follow the compiler's suggestions to get back
on track.

!!! info "Immutability"

    The only crate you're **never** supposed to modify is the [server SDK crate](/guide/project_structure/server_sdk.md), the one that Pavex generates for you. 
    The [server crate][server_crate], on the other hand, is yours to modify as you see fit.

## Lifecycle

If a prebuilt input is only needed to construct [singletons][lifecycles], it'll be discarded after [`ApplicationState::new`](application_state.md) returns.

If it's needed to process requests (e.g. as an input for a middleware), it'll be added as a field to [`ApplicationState`](application_state.md).
In this case, Pavex will treat it as a [singleton][lifecycles] and
require it to implement the [`Send`][Send] and [`Sync`][Sync] traits.

[lifecycles]: constructors.md#lifecycles
[Send]: https://doc.rust-lang.org/std/marker/trait.Send.html
[Sync]: https://doc.rust-lang.org/std/marker/trait.Sync.html
[Blueprint::prebuilt]: /api_reference/pavex/blueprint/struct.Blueprint.html#method.prebuilt
[Blueprint]: /api_reference/pavex/blueprint/struct.Blueprint.html
[server_crate]: /guide/project_structure/server.md
[prebuilt_attr]: /api_reference/pavex/attr.prebuilt.html
[import_other_crates]: /api_reference/pavex/struct.Blueprint.html#dependencies
[import_specific_modules]: /api_reference/pavex/struct.Blueprint.html#specific-modules
